import pandas as pd
import os

def analyze_behavior(data):
    """
    Identifies attendance anomalies based on a threshold.

    Args:
        data (pd.DataFrame): DataFrame with 'attendance_count' and 'average_attendance' columns.

    Returns:
        pd.DataFrame: DataFrame containing rows where 'attendance_count'
                      is significantly lower than 'average_attendance'.
    """
    anomalies = data[data['attendance_count'] < data['average_attendance'] - 2]
    return anomalies

def load_data(file_path):
    """
    Loads data from a CSV file.

    Args:
        file_path (str): The path to the CSV file.

    Returns:
        pd.DataFrame: The loaded DataFrame.

    Raises:
        FileNotFoundError: If the file at the given path does not exist.
    """
    if not os.path.exists(file_path):
        raise FileNotFoundError(f"Error: The file '{file_path}' was not found.")
    try:
        data = pd.read_csv(file_path)
        return data
    except pd.errors.EmptyDataError:
        print(f"Warning: The file '{file_path}' is empty.")
        return pd.DataFrame()
    except pd.errors.ParserError:
        raise pd.errors.ParserError(f"Error: Could not parse the CSV file '{file_path}'. Please ensure it's in a valid format.")

def validate_data(data):
    """
    Validates that the DataFrame contains the necessary columns.

    Args:
        data (pd.DataFrame): The DataFrame to validate.

    Raises:
        ValueError: If the DataFrame is missing required columns.
    """
    required_columns = ['attendance_count', 'average_attendance']
    missing_columns = [col for col in required_columns if col not in data.columns]
    if missing_columns:
        raise ValueError(f"Error: The DataFrame is missing the following required columns: {', '.join(missing_columns)}")

def main():
    """
    Main function to load data, analyze behavior, and print anomalies.
    """
    file_path = 'attendance_data.csv'  # You can change this to your desired file path
    try:
        attendance_data = load_data(file_path)
        if not attendance_data.empty:
            validate_data(attendance_data)
            anomalies = analyze_behavior(attendance_data)
            print("Attendance Anomalies:")
            print(anomalies)
        else:
            print("No data to analyze.")
    except (FileNotFoundError, ValueError, pd.errors.ParserError) as e:
        print(e)

if __name__ == "__main__":
    main()