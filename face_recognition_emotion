import cv2
from deepface import DeepFace
import logging

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

def detect_face_and_emotion(image_path):
    """
    Detects faces and analyzes emotions in the given image.

    Args:
        image_path (str): Path to the image file.

    Returns:
        dict: A dictionary containing emotion analysis results.
    """
    try:
        logging.info(f"Loading image from {image_path}")
        img = cv2.imread(image_path)

        if img is None:
            raise FileNotFoundError(f"Image not found at {image_path}")

        logging.info("Analyzing emotions...")
        result = DeepFace.analyze(img, actions=['emotion'])
        logging.info("Emotion analysis completed successfully.")
        return result
    except FileNotFoundError as e:
        logging.error(e)
        return {"error": str(e)}
    except Exception as e:
        logging.error(f"An error occurred during face and emotion detection: {e}")
        return {"error": "An unexpected error occurred"}

def main():
    """
    Main function to test face and emotion detection.
    """
    # Example image path
    image_path = 'visitor.jpg'  # Ensure this file exists in the same directory

    logging.info("Starting face and emotion detection...")
    result = detect_face_and_emotion(image_path)

    if "error" in result:
        logging.error(f"Failed to analyze emotions: {result['error']}")
    else:
        print("Emotion Analysis Result:")
        print(result)

if __name__ == '__main__':
    main()